<!DOCTYPE html>
<html lang="zh">
<head>
	<meta charset="UTF-8"/>
	<meta name="Description" content="{$zh.config.description}" />
	<meta name="keywords" content="{$zh.config.keywords}" />
	<meta name="format-detection" content="telephone=no" />
	<meta http-equiv="Cache-Control" content="no-transform" />
	<meta http-equiv="Cache-Control" content="no-siteapp" />
	<meta name="applicable-device" content="pc,mobile"/>
	<meta name="viewport" content="width=device-width,initial-scale=1.0,maximum-scale=1,minimum-scale=1,user-scalable=0;" />
	<title>japan_travel</title>
    <pagejs/>
	<link rel="stylesheet" href="__TEMPLATE__/common/css/import.css"/>
	<link rel="stylesheet" href="__TEMPLATE__/common/css/list.css"/>
    <link rel="stylesheet" href="__TEMPLATE__/common/css/base2.css"/>
	<link rel="stylesheet" href="__TEMPLATE__/common/css/jquery.ad-gallery.css"/>

	<!--[if lt IE 9]>
	<script src="__TEMPLATE__/common/scripts/html5.js"></script>
	<![endif]-->
</head>
<body id="japan_travel">
	<!-- 头部 -->
        <include file='__TEMPLATE__/common/inc/__WEBID___header.lbi'/>
	<!-- //头部 -->
	<!-- 中间内容 -->
	<div id="content">
		<!--订单页面-->
        <div class="order_con" >
            <form id="dingfrm" action="?a=index&c=booking&m=index&dopost=savebooking" method="post">
            <div class="order_left">
                <div class="order_data_con">
                    <div class="liuc"><img class="fl" src="__TEMPLATE__/common/tourimages/liucheng.gif"/></div>
                    <!--产品基本信息-->
                    <div class="order_cp_show">
                        <h3>产品编号：{$lineinfo.lineseries}</h3>
                        <div class="order_dl_con">
                            <dl>
                              <dt>产品名称：</dt>
                              <dd>{$lineinfo.title}</dd>
                            </dl>
                            <dl>
                              <dt>产品类型：</dt>
                              <dd>{$lineinfo.suitname}</dd>
                            </dl>
                            <dl>
                              <dt>出发日期：</dt>
                              <dd>{$lineinfo.usedate}</dd>
                            </dl>
                        </div>
                    </div>
                    <!--产品价格数量-->
                    <div class="cp_num_con">
                        <dl>
                            <dt>
                            	<span>类型</span>
                                <span>日期</span>
                                <span>单价</span>
                                <span>购买数量</span>
                                <span>金额</span>
                            </dt>
                            <dd>
                                <if value="empty($lineinfo['hasadult'])">
                                <ul style="display:none" >
                                <else/>
                                <ul  >
                                </if>
                                    <li>成人</li>
                                    <li>{$lineinfo.usedate}</li>
                                    <li>&yen;{$lineinfo.price}</li>
                                    <li>
                                        <span class="down">-</span>
                                        <input type="text" class="gm_num" id="adultnum" name="adultnum" readonly value="{$lineinfo.dingnum}" />
                                        <span class="up">+</span>
                                    </li>
                                    <li>&yen;<span class="adulttotalprice"></span></li>
                                </ul>
                                
                                <if value="empty($lineinfo['haschild'])">
                                <ul style="display:none" >
                                <else/>
                                <ul  >
                                </if>
                                    <li>儿童</li>
                                    <li>{$lineinfo.usedate}</li>
                                    <li>&yen;{$lineinfo.childprice}</li>
                                    <li>
                                        <span class="down">-</span>
                                        <input type="text" class="gm_num" id="childnum" name="childnum" readonly value="{$lineinfo.childnum}" />
                                        <span class="up">+</span>
                                    </li>
                                    <li>&yen;<span class="childtotalprice"></span></li>
                                </ul>
                                
                                <if value="empty($lineinfo['hasold'])">
                                <ul style="display:none" >
                                <else/>
                                <ul  >
                                </if>
                                    <li>婴儿</li>
                                    <li>{$lineinfo.usedate}</li>
                                    <li>&yen;{$lineinfo.oldprice}</li>
                                    <li>
                                        <span class="down">-</span>
                                        <input type="text" class="gm_num" id="oldnum" name="oldnum" readonly value="{$lineinfo.oldnum}" />
                                        <span class="up">+</span>
                                    </li>
                                    <li>&yen;<span class="oldtotalprice"></span></li>
                                </ul>
                            </dd>
                        </dl>
                    </div>
                    <!--预定信息-->
                    <div class="yd_msg">
                        <h3>预定信息<span>快速下单，无需注册登录！</span></h3>
                        <div class="msg_con">
                            <dl>
                                <dt>预定联系人：</dt>
                                <dd><input type="text" name="linkman" id="linkman" class="msg_text" value="{$lineinfo.linkman}" /><span>（*必填）</span></dd>
                            </dl>
                            <dl>
                                <dt>性别：</dt>
                                <dd>
                                    <input type="radio" name="linksex" id="linksex" value="1" />男
                                    &nbsp;&nbsp;&nbsp;<input type="radio" name="linksex" id="linksex" value="2" />女
                                </dd>
                            </dl>
                            <dl>
                                <dt>联系手机：</dt>
                                <dd><input type="text" class="msg_text" name="linktel" id="linktel" value="{$lineinfo.linktel}" /><span>（*必填，将作为订单查询和处理的凭证）</span></dd>
                            </dl>
                            <dl>
                                <dt>邮箱：</dt>
                                <dd><input type="text" class="msg_text" name="linkemail" id="linkemail" value="{$lineinfo.linkemail}" /><span></span></dd>
                            </dl>
                            <dl>
                                <dt>处理支店</dt>
                                <dd>
                                    <select id="handleshop" name="handleshop">
                                        <foreach from="$handleshop" value="$shopD" key="$shopK" >
                                            <option value="{$shopK}">{$shopD}</option>
                                        </foreach>
                                        
                                    </select>
                                </dd>
                            </dl>
                            <dl>
                                <dt>订单留言：</dt>
                                <dd><textarea class="msg_area" name="remarkinfo" cols="" rows=""></textarea></dd>
                            </dl>
                        </div>
                    </div>
                    <!--游客信息-->
                    <div class="yk_msg">
                        <h3>游客信息<span style="cursor: pointer" id="tourerlist">点击展开，填写每位游客身份信息</span></h3>
                        <div class="msg_con" id="tourer">
                        </div>
                    </div>
                    <!--订单金额-->
                    <div class="order_money">
                        <p><em>订单金额：&yen;<span class="totalprice"></span>元</em></p>
                    </div>
                    <!--预定按钮-->
                    <div class="tj_btn_order">
                    	<a href="javascript:;" class="btnsaveorder">提交订单</a>
                    </div>
                </div>
            </div>
            <!--右侧订单数据-->
             <div class="order_box_right">
                <div class="order_rig">
                    <div class="order_js_tit">订单结算</div>
                    <div class="order_box">
                        <div class="cl_cp_tj">
                            <ul>
                                <if value="empty($lineinfo['hasadult'])">
                                <li style="display:none" >
                                <else/>
                                <li  >
                                </if>
                                    <span class="sp_1">成人{$lineinfo.price}</span>
                                    <span class="sp_2 adulttotalnum">{$lineinfo.dingnum}</span>
                                    <span class="sp_3 adulttotalprice"></span>
                                </li>
                                <if value="empty($lineinfo['haschild'])">
                                <li style="display:none" >
                                <else/>
                                <li  >
                                </if>
                                    <span class="sp_1">儿童{$lineinfo.childprice}</span>
                                    <span class="sp_2 childtotalnum">{$lineinfo.childnum}</span>
                                    <span class="sp_3 childtotalprice"></span>
                                </li>
                                <if value="empty($lineinfo['hasold'])">
                                <li style="display:none" >
                                <else/>
                                <li  >
                                </if>
                                    <span class="sp_1">婴儿{$lineinfo.oldprice}</span>
                                    <span class="sp_2 oldtotalnum">{$lineinfo.oldnum}</span>
                                    <span class="sp_3 oldtotalprice"></span>
                                </li>
                            </ul>
                        </div>
                        <div class="order_num">
                            <p class="p1">订单金额：<span class="totalprice"></span></p>
                            <p class="p2">支付金额：<span class="payprice"></span></p>
                        </div>
                        <div class="tj_order_btn">
                            <input type="hidden" id="adultprice" value="{$lineinfo.price}"/>
                            <input type="hidden" id="childprice" value="{$lineinfo.childprice}"/>
                            <input type="hidden" id="oldprice" value="{$lineinfo.oldprice}"/>
                            <input type="hidden" name="dingjin" value="{$lineinfo.dingjin}"/>
                            <input type="hidden" name="productautoid" value="{$lineinfo.id}"/>
                            <input type="hidden" name="productaid" value="{$lineinfo.aid}"/>
                            <input type="hidden" name="productname" value="{$lineinfo.title}"/>
                            <input type="hidden" name="suitid" id="suitid" value="{$lineinfo.suitid}"/>
                            <input type="hidden" name="usedate" value="{$lineinfo.usedate}"/>
                            <input type="button" class="btnsaveorder" value="提交订单" />
                        </div>
                    </div>
                </div>
            </div>
            </form>
        </div>
	</div>
    
	<!-- //中间内容 -->
	<!-- 底部 -->
		<!--#include virtual="__TEMPLATE__/common/inc/footer.lbi"-->
	<!-- //底部 -->
	<script src="__TEMPLATE__/common/scripts/jsloader.js" type="text/javascript"></script>
	<script src="__TEMPLATE__/common/scripts/jquery.ad-gallery.min.js" type="text/javascript"></script>
	<script>
		$(function(){
			
            var orderRigHeight = $('.order_rig').offset().top;
            $(window).scroll(function(){
    			  var scroHeight = $(document).scrollTop();
    
    			  if(scroHeight>=orderRigHeight){
    				  $('.order_rig').css({"position":"fixed","z-index":"999","top":"0"});
    			  }else if(scroHeight<orderRigHeight){
    				  $('.order_rig').css({"position":"static"});
    			  }
			  
		      })
            //统计价格
            booking.countPrice();
            
            //人数添加事件
              $(".cp_num_con").find('.up').click(function(){
                  var txt = $(this).parents('li').first().find('.gm_num');
                  txt.val(Number(txt.val())+1);
                  var cn = Number(txt.val());
                  if(cn>6){
                    txt.val(6);
                    alert('最大6位');
                  }
                  booking.countPrice();
                  booking.addTourer();
              })
              //人数减少事件
               $(".cp_num_con").find('.down').click(function(){
                   var txt = $(this).parents('li').first().find('.gm_num');
                   var n = Number(txt.val())-1;
                   n = n<0 ? 0 : n;
                   txt.val(n);
                   booking.countPrice();
                   booking.removeTourer();
    
               })
               
               
               //联系人隐藏
                 $("#tourerlist").click(function(){
                     $("#tourer").toggle();
                 })

       
               //添加联系人
                booking.addTourer();
                
                //下订单
           $(".btnsaveorder").click(function(){
               $("#dingfrm").submit();
           })
       
		});
        var booking = {
            countPrice:function(){
                var childnum = Number($("#childnum").val());
                var adultnum = Number($("#adultnum").val());
                var oldnum = Number($("#oldnum").val());
                
                var childprice = $("#childprice").val();
                var adultprice = $("#adultprice").val();
                var oldprice = $("#oldprice").val();
                
                childtotalprice = childnum * childprice;
                adulttotalprice = adultnum * adultprice;
                oldtotalprice = oldnum * oldprice;
                totalprice = childtotalprice + adulttotalprice + oldtotalprice;
                
                $('.childtotalprice').html(childtotalprice);
                $('.adulttotalprice').html(adulttotalprice);
                $('.oldtotalprice').html(oldtotalprice);
                
                $('.adulttotalnum').html(adultnum);
                $('.childtotalnum').html(childnum);
                $('.oldtotalnum').html(oldnum);
                
                $('.totalprice').html(totalprice);
                $('.payprice').html(totalprice);
            },
            addTourer:function(){
                var childnum = Number($("#childnum").val());
                var adultnum = Number($("#adultnum").val());
                var oldnum = Number($("#oldnum").val());
                var totalnum = childnum+adultnum+oldnum;
                var $info = '';
                var hasnum = $('#tourer').find('.msg_list').length+1;
                for(i=hasnum;i<=totalnum;i++){
                    $info = '<div class="msg_list">';
                    $info +='   <ul>';
                    $info +='       <li><em>游客'+i+'</em></li>'
                    $info +='       <li>'
                    $info +='       <em>姓名：</em>'
                    $info +='       <input type="text" name="tourername'+i+'" class="text_msg tourname" id="tourname'+i+'" />'
                    $info +='       <label><input type="radio" name="tourersex'+i+'" value="男" checked >男</label>'
                    $info +='       <label><input type="radio" name="tourersex'+i+'" value="女" >女</label>'
                    $info +='       </li>'
                    $info +='       <li>'
                    $info +='       <em>姓氏拼音：</em>'
                    $info +='       <input type="text" name="tourerfnamealp'+i+'" class="text_msg tourname" id="tourerfnamealp'+i+'" />'
                    $info +='       </li>'
                    $info +='       <li>'
                    $info +='       <em>名字拼音：</em>'
                    $info +='       <input type="text" name="tourerlnamealp'+i+'" class="text_msg tourname" id="tourerlnamealp'+i+'" />'
                    $info +='       </li>'
                    $info +='       <li>'
                    $info +='       <em>出生日期：</em>'
                    $info +='       <input type="text" name="tourerbirthdayy'+i+'" style="width:50px;" id="tourerbirthdayy'+i+'" />'+'年'
                    $info +='       <input type="text" name="tourerbirthdaym'+i+'" style="width:50px;" id="tourerbirthdaym'+i+'" />'+'月'
                    $info +='       <input type="text" name="tourerbirthdayd'+i+'" style="width:50px;" id="tourerbirthdayd'+i+'" />'+'日'
                    $info +='       </li>'
                    $info +='       <li>'
                    $info +='       <em>护照：</em>'
                    $info +='       <input type="text" name="tourerpassbook'+i+'" class="text_msg tourname" id="tourerpassbook'+i+'" />'
                    $info +='       </li>'
                    
                    $info +='</ul>'
                    $info +='</div>';
                    $("#tourer").append($info);
                }
            },
            removeTourer:function(){
                $('#tourer').find('.msg_list').last().remove();
            }
        }
        
	</script>
</body>
</html>